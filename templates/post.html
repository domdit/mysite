{% set active_page = "blog-page" %}

{% extends "layout.html" %}

{% block script %}

    <script src="https://cloud.tinymce.com/5/tinymce.min.js?apiKey=666y222z8n2iljdtmetub442mdezzf4a1qtk2eskok9vnj3s"></script>

    <script>
        tinymce.init({
            selector: 'textarea',
            height: 200,
            plugins: [
                'advlist autolink lists link image charmap print preview anchor textcolor',
                'searchreplace visualblocks code fullscreen imagetools',
                'insertdatetime media table paste code help wordcount codesample'
            ],
            toolbar: 'undo redo | formatselect | bold italic backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | code codesample | help',
            content_css: [
                '//fonts.googleapis.com/css?family=Lato:300,300i,400,400i',
                '//www.tiny.cloud/css/codepen.min.css'
            ],

            toolbar_drawer: 'sliding',
            tinycomments_mode: 'embedded',
            tinycomments_author: 'Author name',
            images_upload_base_path: '/static/upload',
            menubar: "tools table format view insert edit",
            paste_data_images: true

        });

    </script>

{% endblock %}

{% block main %}

<div id="blog" class="container" style="padding-top: 30px;">

    <div class="row">

        <div class="col-md-8">


            <div class="blog-post border rounded">
                <h1>{{post.name|safe}}</h1>
                <small>{{post.date|safe}} by Dominic DiTaranto</small>
                <small>
                    {% if current_user.is_authenticated %}

                        <a href="{{url_for('update', post_id=post.blog_id)}}">
                            Edit
                        </a>
                        |
                        <a href="{{url_for('delete_item', item_id=post.blog_id, table='Blog', location='blog')}}">
                            Delete
                        </a>




                    {% endif %}


                </small>
                <hr>
                <p>
                    {{post.text|safe}}

                </p>



                    <small>
                        <b>Category</b>:
                        <a href="{{url_for('query', term=post.category)}}">{{post.category}}</a><br>

                        <b>Tags:</b>
                            {% for tag in post.tags %}
                                <a href="{{url_for('query', term=tag.name)}}">{{tag.name}}</a>{%if not loop.last%}, {%else%} {%endif%}
                            {% endfor %}
                    </small>

                <hr>


                <h3 class="underline">Comments({{count}}):</h3>

                {% if comments %}

                    {% for comment in comments %}

                    <div class="pt-3 pr-3 pl-3 border-bottom">
                        <h5 style="margin-bottom:-10px;">{{comment.name}}</h5>

                        {% if comment.email %}
                        <small>{{comment.email}}</small>
                        {%endif%}

                        <small>{{comment.date}}</small>

                        {% if current_user.is_authenticated %}
                            <small>
                                <a href="{{url_for('delete_item', item_id=comment.id, table='Comment', location=post.blog_id)}}">
                                Delete
                                </a>
                            </small>

                        {% endif %}

                        <p style="margin-top:-10px;">
                            {{comment.text|safe}}

                        </p>




                    </div>

                    {% endfor %}
                {% else %}


                <center>
                    <p>Be the first to leave a comment!</p>

                </center>



                {% endif %}



                <form id="comment" action="" class="mt-3" method="POST" enctype="multipart/form-data">
                    {{ form.hidden_tag() }}
                    <fieldset class="form-group">
                        <legend class="border-bottom mb-4 mt-3">Leave a Comment:</legend>

                                <div class="form-group">
                                    {{ form.name.label(class="form-control-label") }}
                                    {{ form.name(class="form-control form-control-sm") }}
                                    {% if form.name.errors %}
                                        {% for error in form.name.errors %}
                                            <span class="text-danger">{{ error }}</span></br>
                                        {% endfor %}
                                    {% endif %}
                                </div>


                                <div class="form-group">
                                    {{ form.email.label(class="form-control-label") }}:
                                    {{ form.email(class="form-control form-control-sm") }}
                                    {% if form.email.errors %}
                                        {% for error in form.email.errors %}
                                            <span class="text-danger">{{ error }}</span></br>
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                <div class="form-group">
                                    {{ form.text.label() }}
                                    {{ form.text(class="form-control-file") }}
                                    {% if form.text.errors %}
                                        {% for error in form.text.errors %}
                                            <span class="text-danger">{{ error }}</span></br>
                                        {% endfor %}
                                    {% endif %}
                                </div>

                                <div class="form-group float-left ">
                                    {{recaptcha}}

                                </div>

                    </fieldset>
                    <div class="form-group">
                        {{ form.comment_submit(class="btn btn-custom") }}
                    </div>
                </form>



                    <div class="container mt-5">

                        <div class="row">
                            <div class="align-left">
                                {% if prev_post %}
                                    <b>Previous Post</b>
                                {% endif %}
                            </div>
                            <div class="align-right" style="margin-left:auto;">
                                {% if next_post %}
                                    <b>Next Post</b>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            <div class="align-left">
                                {% if prev_post %}
                                    <a href="{{url_for('post', post_id=prev_post.blog_id)}}">{{prev_post.name}}</a>
                                {% endif %}

                            </div>
                            <div class="align-right" style="margin-left:auto;">
                                {% if next_post %}
                                    <a href="{{url_for('post', post_id=next_post.blog_id)}}">{{next_post.name}}</a>
                                {% endif %}

                            </div>

                        </div>

                    </div>


                </div>


            </div>

             <div class="col-md-4">

                {% include 'sidebar.html' %}

            </div>


        </div>


    </div>




</div>



{% endblock %}